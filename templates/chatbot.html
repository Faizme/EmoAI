{% extends "base.html" %}

{% block title %}Chat - EmoAI{% endblock %}

{% block content %}
<div class="premium-chat-container">
    <div class="main-chat-area">
        <div class="elegant-chat-header">
            <div class="header-left">
                <h1 class="app-name">EmoAI</h1>
                <p class="app-tagline">Your Emotional Intelligence Companion</p>
            </div>
            <div class="header-actions">
                <button onclick="window.location.href='/dashboard'" class="elegant-btn btn-outline">
                    Dashboard
                </button>
                <button onclick="viewJournal()" class="elegant-btn btn-outline">
                    Journal
                </button>
                <button onclick="openReminderSettings()" class="elegant-btn btn-outline">
                    Settings
                </button>
                <button onclick="logout()" class="elegant-btn btn-outline">
                    Logout
                </button>
            </div>
        </div>
        
        <div class="conversation-area" id="chatBox">
            <div class="ai-message-elegant fade-in">
                <div class="message-content">
                    <div class="message-sender">EmoAI</div>
                    <div class="message-text">Hello {{ user_name }}, how are you feeling today?</div>
                </div>
            </div>
        </div>
        
        <div class="input-section">
            <div class="input-container">
                <button onclick="toggleVoiceInput()" class="voice-btn" id="voiceBtn" title="Voice input">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
                <input type="text" id="userInput" placeholder="Share your thoughts with EmoAI..." 
                       class="premium-input" autocomplete="off">
                <button onclick="sendMessage()" id="sendBtn" class="send-btn-elegant">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
            <div class="input-actions">
                <button onclick="getSummary()" class="action-link">Save as Journal Entry</button>
                <button onclick="clearChat()" class="action-link">New Conversation</button>
            </div>
        </div>
        
        <div class="user-info-badge">
            <div class="user-avatar">{{ user_name[0].upper() }}</div>
            <div class="user-details">
                <div class="user-name">{{ user_name }}</div>
                <div class="user-status">Online</div>
            </div>
        </div>
    </div>
    
    <!-- Daily Reminder Popup -->
    <div id="reminderPopup" class="elegant-modal hidden">
        <div class="elegant-modal-content">
            <div class="modal-icon">ðŸŒŸ</div>
            <h3 id="reminderGreeting">Daily Check-in</h3>
            <p id="reminderMessage">Have you made progress on your goal today?</p>
            <div class="modal-actions">
                <button onclick="showProgressForm()" class="elegant-btn btn-primary">Yes, add progress</button>
                <button onclick="dismissReminder()" class="elegant-btn btn-outline">Not today</button>
            </div>
        </div>
    </div>
    
    <!-- Progress Note Form -->
    <div id="progressForm" class="elegant-modal hidden">
        <div class="elegant-modal-content">
            <span class="close-btn" onclick="closeProgressForm()">&times;</span>
            <h2>Log Your Progress</h2>
            <p class="modal-subtitle">What did you accomplish today?</p>
            <textarea id="progressNote" class="premium-textarea" rows="4" 
                      placeholder="Describe your progress..."></textarea>
            <button onclick="saveProgress()" class="elegant-btn btn-primary full-width">Save Progress</button>
        </div>
    </div>
    
    <!-- Reminder Settings Modal -->
    <div id="reminderSettingsModal" class="elegant-modal hidden">
        <div class="elegant-modal-content large-modal">
            <span class="close-btn" onclick="closeReminderSettings()">&times;</span>
            
            <h2>Reminder Settings</h2>
            
            <div class="settings-section">
                <h3>Create New Reminder</h3>
                <textarea id="newReminderMessage" class="premium-textarea" rows="3" 
                          placeholder="What would you like to be reminded about?"></textarea>
                <input type="time" id="newReminderTime" class="premium-input" 
                       placeholder="Time (optional)">
                <button onclick="createReminder()" class="elegant-btn btn-primary">Create Reminder</button>
            </div>
            
            <div class="settings-section">
                <h3>Your Reminders</h3>
                <div id="remindersList" class="reminders-list-elegant">
                    <p class="loading-text">Loading reminders...</p>
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Global Settings</h3>
                <div class="setting-row">
                    <span>Enable Daily Reminders</span>
                    <label class="toggle-switch-elegant">
                        <input type="checkbox" id="reminderToggle" onchange="updateReminderToggle()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-row">
                    <label>Default Reminder Time</label>
                    <input type="time" id="reminderTime" class="premium-input" onchange="updateReminderTime()">
                </div>
            </div>
            
            <button onclick="closeReminderSettings()" class="elegant-btn btn-primary full-width">Done</button>
        </div>
    </div>
    
    <!-- Journal Summary Modal -->
    <div id="summaryModal" class="elegant-modal hidden">
        <div class="elegant-modal-content">
            <span class="close-btn" onclick="closeSummary()">&times;</span>
            <h2>Your Journal Entry</h2>
            <div id="summaryText" class="summary-content"></div>
            
            <div class="mood-selection">
                <label>How are you feeling?</label>
                <select id="moodSelect" class="premium-input">
                    <option value="Happy">Happy</option>
                    <option value="Calm">Calm</option>
                    <option value="Sad">Sad</option>
                    <option value="Anxious">Anxious</option>
                    <option value="Frustrated">Frustrated</option>
                    <option value="Thoughtful">Thoughtful</option>
                    <option value="Tired">Tired</option>
                    <option value="Motivated">Motivated</option>
                </select>
            </div>
            
            <button onclick="saveJournal()" class="elegant-btn btn-primary full-width">Save to Journal</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
{% endblock %}
