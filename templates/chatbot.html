{% extends "base.html" %}

{% block title %}Chat - Vibe Journal AI{% endblock %}

{% block content %}
<div class="chatbot-container">
    <div class="animated-bg"></div>
    
    <div class="chat-header glass">
        <h2 class="glow-text">ğŸ’œ VILUN</h2>
        <div class="header-buttons">
            <button onclick="openReminderSettings()" class="icon-btn bell-btn" title="Reminder Settings">ğŸ””</button>
            <button onclick="window.location.href='/dashboard'" class="icon-btn">ğŸ“Š Dashboard</button>
            <button onclick="viewJournal()" class="icon-btn">ğŸ“š Journal</button>
            <button onclick="logout()" class="icon-btn">ğŸšª Logout</button>
        </div>
    </div>
    
    <!-- Daily Reminder Popup -->
    <div id="reminderPopup" class="reminder-popup hidden">
        <div class="reminder-content glass">
            <div class="reminder-icon">ğŸŒŸ</div>
            <h3 id="reminderGreeting">Hey there!</h3>
            <p id="reminderMessage">Did you take one small step for your goal today?</p>
            <div class="reminder-buttons">
                <button onclick="showProgressForm()" class="btn-primary glow-btn">âœ… Yes, add progress</button>
                <button onclick="dismissReminder()" class="btn-secondary">âŒ Not today</button>
            </div>
        </div>
    </div>
    
    <!-- Progress Note Form (shown after clicking Yes) -->
    <div id="progressForm" class="modal hidden">
        <div class="modal-content glass">
            <span class="close-modal" onclick="closeProgressForm()">&times;</span>
            <h2 class="glow-text">Log Your Progress ğŸ“</h2>
            <p style="color: #b4a5d9; margin-bottom: 1rem;">What did you do today?</p>
            <textarea id="progressNote" class="glass-input" rows="4" placeholder="Write a short note about your progress..."></textarea>
            <button onclick="saveProgress()" class="btn-primary glow-btn">Save Progress âœ…</button>
        </div>
    </div>
    
    <!-- Reminder Settings Modal -->
    <div id="reminderSettingsModal" class="modal hidden">
        <div class="modal-content glass">
            <span class="close-modal" onclick="closeReminderSettings()">&times;</span>
            <h2 class="glow-text">Reminder Settings ğŸ””</h2>
            
            <div class="setting-row">
                <label class="toggle-label">
                    <span>Daily Reminders</span>
                    <div class="toggle-switch">
                        <input type="checkbox" id="reminderToggle" onchange="updateReminderToggle()">
                        <span class="slider"></span>
                    </div>
                </label>
            </div>
            
            <div class="setting-row" id="timePickerRow">
                <label>Reminder Time (optional)</label>
                <input type="time" id="reminderTime" class="glass-input" onchange="updateReminderTime()">
                <p style="color: #b4a5d9; font-size: 0.9rem; margin-top: 0.5rem;">
                    Leave blank for reminders on page load
                </p>
            </div>
            
            <button onclick="closeReminderSettings()" class="btn-primary">Done</button>
        </div>
    </div>
    
    <div class="chat-box" id="chatBox">
        <div class="ai-message fade-in">
            <div class="message-bubble">
                <strong>VILUN:</strong> Hi {{ user_name }}! ğŸ‘‹ How are you feeling today?
            </div>
        </div>
    </div>
    
    <div class="chat-input-area glass">
        <input type="text" id="userInput" placeholder="Share your thoughts..." class="chat-input" autocomplete="off">
        <button onclick="sendMessage()" id="sendBtn" class="send-btn">Send</button>
    </div>
    
    <div class="action-buttons">
        <button onclick="getSummary()" class="action-btn glow-btn">ğŸ“ Get Journal Summary</button>
        <button onclick="clearChat()" class="action-btn-secondary">ğŸ”„ New Conversation</button>
    </div>
    
    <div id="summaryModal" class="modal">
        <div class="modal-content glass">
            <span class="close-modal" onclick="closeSummary()">&times;</span>
            <h2 class="glow-text">Your Journal Entry</h2>
            <div id="summaryText" class="summary-text"></div>
            
            <div class="save-journal-form">
                <label>How are you feeling? <span class="mood-emoji" id="moodEmoji">ğŸ˜Š</span></label>
                <select id="moodSelect" class="glass-input" onchange="updateMoodEmoji()">
                    <option value="ğŸ˜Š Happy">ğŸ˜Š Happy</option>
                    <option value="ğŸ˜Œ Calm">ğŸ˜Œ Calm</option>
                    <option value="ğŸ˜” Sad">ğŸ˜” Sad</option>
                    <option value="ğŸ˜° Anxious">ğŸ˜° Anxious</option>
                    <option value="ğŸ˜¤ Frustrated">ğŸ˜¤ Frustrated</option>
                    <option value="ğŸ¤” Thoughtful">ğŸ¤” Thoughtful</option>
                    <option value="ğŸ˜´ Tired">ğŸ˜´ Tired</option>
                    <option value="ğŸ”¥ Motivated">ğŸ”¥ Motivated</option>
                </select>
                
                <label>Goal Progress (optional)</label>
                <textarea id="goalProgress" class="glass-input" rows="3" placeholder="Any progress toward your goal today?"></textarea>
                
                <button onclick="saveJournal()" class="btn-primary glow-btn">Save to Journal âœ…</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chatbot.css') }}">
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>
{% endblock %}
